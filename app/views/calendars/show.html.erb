<% content_for :head do %>
  <%= stylesheet_link_tag 'calendar-day' %>
  <%= stylesheet_link_tag 'event-details' %>
<% end %>

<% content_for :sidebar do %>
  <%= render :partial => 'events/new_form' %>
  <%= render :partial => 'task_list',
              :locals => { :events => @events }
  %>
<% end %>
<%
  next_day = @date + 1; 
  prev_day = @date - 1; 
%>
<a class="day-nav prev" href="/calendars/show?date=<%= prev_day.to_s(:us_long_year) %>">&laquo; <%= prev_day.to_s(:short_day_month_first) %></a>
<a class="day-nav next" href="/calendars/show?date=<%= next_day.to_s(:us_long_year) %>"><%= next_day.to_s(:short_day_month_first) %> &raquo;</a>
<h2 class="day-date"><%= @date.to_s(:short_day_month_first) %></h2>
<div id="day" class="day" data-date="<%= @day.to_s %>">
  <div class="day-top">
    <h3>All Day</h3>
    <div class="day-top-allday">
      <ul class="day-allday">
        <% get_all_days(@events).
            each do |event| %>
          <li id="<%= event.id %>" data-event-id="<%= event.id %>" data-name="<%= event.name %>" class="event allday">
            <span class="event-title">
              <%= event.name %>
            </span>
            <div class="event-details details_<%= event.id %>">
               <%= render :partial => "events/details", :locals => { :event => event } %>
             </div>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
  <div class="day-wrapper">
    <ul class="day-hours">
      <%= render :partial => 'timeline' %>
    </ul>
    <div class="day-full">
      <ul class="day-deadlines">
        <% get_deadlines(@events).
            each do |event| %>
            <li id="<%= event.id %>" data-event-id="<%= event.id %>" data-name="<%= event.name %>" data-starts-at="<%= event.starts_at %>" data-ends-at="<%= event.ends_at %>" class="event deadline <%= event.completed_at ? "complete" : "incomplete" %>">
              <span class="event-title">
                <input id="event-complete-<%= event.id %>" name="deadline-complete-<%= event.id %>" type="checkbox" />
                <label>
                  <%= event.starts_at.to_s(:simple) %> <%= event.name %>
                </label>
              </span>
              <div class="event-details details_<%= event.id %>">
                 <%= render :partial => "events/details", :locals => { :event => event } %>
               </div>
            </li>
        <% end %>
      </ul>
      <ul class="day-appointments">
        <% get_appointments(@events).
            each do |event| %>
            <li id="<%= event.id %>" data-event-id="<%= event.id %>" data-name="<%= event.name %>" data-starts-at="<%= event.starts_at %>" data-ends-at="<%= event.ends_at %>" class="event appointment"> 
              <span class="event-title">
                <%= event.starts_at.to_s(:simple) %> &ndash; <%= event.ends_at.to_s(:simple) %> <%= event.name %>
              </span>
              <div class="event-details details_<%= event.id %>">
                 <%= render :partial => "events/details", :locals => { :event => event } %>
               </div>
            </li>
        <% end %>
      </ul>
    </div>
  </div>
  <br class="clear" />
</div>  