<tr class="week-allday">
  <th>All Day</th>
  <% (date.beginning_of_week..date.end_of_week).each do |day| %>
  <td class="day-<%= day.wday %>">
    <ul class="alldays">
      <% events.select{ |e| e.starts_at.to_date == day || e.ends_at.to_date == day || 
          (e.starts_at.to_date < day && e.ends_at.to_date > day ) }.each do |a| %>
            <%= render :partial => "events/event_allday", :locals => { :event => a } %>
      <% end %>
    </ul>
  </td>
  <% end %>
</tr>